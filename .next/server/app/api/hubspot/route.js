"use strict";(()=>{var e={};e.id=99,e.ids=[99],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1051:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l});var o={};s.r(o),s.d(o,{PATCH:()=>u,POST:()=>i});var r=s(49303),n=s(88716),a=s(60670);async function i(e){try{let t=await e.json(),{nombre:s,email:o,telefono:r,mensaje:n,aceptaComunicaciones:a,aceptaPolitica:i,flowAnswers:u={}}=t;console.log("\uD83D\uDCE9 Datos recibidos en API HubSpot:"),console.log({nombre:s,email:o,telefono:r,mensaje:n,aceptaComunicaciones:a,aceptaPolitica:i,flowAnswers:u});let c=Object.entries(u).map(([e,t])=>`Paso ${e}: ${t}`).join("\n"),p=`${n}

--- Respuestas del flujo ---
${c}`,l=await fetch("https://api.hubapi.com/crm/v3/objects/contacts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.HUBSPOT_TOKEN}`},body:JSON.stringify({properties:{email:o,firstname:s,phone:r,servicio:t.servicio,hubspot_owner_id:"83531397",hs_lead_status:"NEW",unidad_de_negocio:"Posting",canal_de_llegada:"P\xe1gina web",mensaje:p,he_leido_y_acepto_la_politica_de_tratamiento_de_datos_personales:i?"true":"false"}})}),d=null;if(l.ok)return d=(await l.json()).id,new Response(JSON.stringify({success:!0,contactId:d}),{status:200});if(409===l.status){let e=(await l.text()).match(/Existing ID: (\d+)/);if(e)return d=e[1],new Response(JSON.stringify({success:!0,contactId:d}),{status:200})}let h=await l.text();return new Response(JSON.stringify({success:!1,error:h}),{status:500})}catch(e){return console.error("Error interno HubSpot:",e),new Response(JSON.stringify({success:!1,error:e.message}),{status:500})}}async function u(e){try{let{contactId:t,properties:s}=await e.json();if(!t)return new Response(JSON.stringify({success:!1,error:"Falta el contactId"}),{status:400});if(!s||"object"!=typeof s)return new Response(JSON.stringify({success:!1,error:"Las propiedades no son v\xe1lidas"}),{status:400});console.log("\uD83D\uDD27 Actualizando contacto:",t,s);let o=await fetch(`https://api.hubapi.com/crm/v3/objects/contacts/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.HUBSPOT_TOKEN}`},body:JSON.stringify({properties:s})}),r=await o.json();if(!o.ok)return console.error("❌ Error PATCH HubSpot:",r),new Response(JSON.stringify({success:!1,error:r}),{status:o.status});return console.log("✔ Contacto actualizado:",r),new Response(JSON.stringify({success:!0,result:r}),{status:200})}catch(e){return console.error("\uD83D\uDD25 Error interno en PATCH:",e),new Response(JSON.stringify({success:!1,error:e.message}),{status:500})}}let c=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/hubspot/route",pathname:"/api/hubspot",filename:"route",bundlePath:"app/api/hubspot/route"},resolvedPagePath:"C:\\xampp\\htdocs\\sites\\paginas\\posting\\src\\app\\api\\hubspot\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:d}=c,h="/api/hubspot/route";function g(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:l})}},49303:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[948],()=>s(1051));module.exports=o})();